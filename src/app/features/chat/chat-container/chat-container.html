<div class="flex w-screen h-screen bg-slate-950 p-4 gap-4 overflow-hidden relative">
  
  <div class="absolute inset-0 bg-cover bg-center opacity-10 pointer-events-none"></div>

  <!-- Left Sidebar -->
  <aside class="w-80 flex flex-col bg-slate-900/60 backdrop-blur-xl border border-slate-700/50 rounded-3xl shadow-2xl z-20 overflow-hidden relative">
    
    <!-- Backdrop -->
    <div class="absolute inset-0 z-40 bg-slate-950/60 backdrop-blur-sm transition-opacity duration-300"
         [class.opacity-100]="showSearchUser() || showSettings()"
         [class.opacity-0]="!showSearchUser() && !showSettings()"
         [class.pointer-events-none]="!showSearchUser() && !showSettings()"
         (click)="showSearchUser() ? toggleSearchUser() : toggleSettings()">
    </div>

    <!-- Search User Bottom Sheet -->
    <app-search-user 
      class="absolute bottom-[73px] left-0 right-0 z-40 h-[calc(55%-50px)] transition-transform duration-500 cubic-bezier(0.32, 0.72, 0, 1)"
      [class.translate-y-0]="showSearchUser()"
      [class.translate-y-[150%]]="!showSearchUser()"
      [conversations]="conversations()"
      (close)="toggleSearchUser()" 
      (conversationCreated)="loadConversations()">
    </app-search-user>

    <!-- Settings Bottom Sheet -->
    <app-settings-modal
      class="absolute bottom-[73px] left-0 right-0 z-40 h-auto max-h-[40%] transition-transform duration-500 cubic-bezier(0.32, 0.72, 0, 1)"
      [class.translate-y-0]="showSettings()"
      [class.translate-y-[150%]]="!showSettings()"
      (close)="toggleSettings()">
    </app-settings-modal>

    <div class="p-5 pb-2">
      <div class="text-center">
        <img src="icons/nexus_logo_nombre.svg" alt="Nexus Logo" class=" w-auto h-[48px] mx-auto mb-4">
      </div>

      <div class="relative group">
        <span class="material-icons absolute left-3 top-2.5 text-slate-500 group-focus-within:text-blue-400 transition">search</span>
        <input type="text" placeholder="Search" 
          class="w-full bg-slate-800/50 border border-slate-700 rounded-xl py-2 pl-10 pr-4 text-sm focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition placeholder-slate-500"
				>
      </div>
    </div>

    <div class="flex-1 overflow-y-auto px-3 space-y-1 mt-2 custom-scrollbar">
      
      @if (isLoading()) {
        <div class="flex flex-col items-center justify-center h-32 text-slate-500">
          <div class="w-8 h-8 border-4 border-blue-500/30 border-t-blue-500 rounded-full animate-spin mb-2"></div>
          <p class="text-xs">Loading chats...</p>
        </div>
      } @else {
        @for(conversation of conversations(); track conversation.id ){
          <a [routerLink]="['/chat', conversation.id]" 
            class="block mb-1 relative rounded-xl transition-all duration-200 hover:bg-slate-800/30 group" 
            routerLinkActive="active-chat-class">
            
            <!-- Active Indicator -->
            <div class="active-indicator absolute left-0 top-1/2 -translate-y-1/2 w-1 h-0 bg-blue-500 rounded-r-full shadow-[0_0_15px_rgba(59,130,246,0.8)] opacity-0 transition-all duration-300"></div>

            <app-chat-card 
              [username]="conversation.participant_two_username" 
              [lastMessage]="conversation.last_message_content" 
              [avatarUrl]="'/avatars/avatar_default.svg'" 
              [time]="conversation.last_message_at" 
              [isOnline]="false" 
              [isActive]="false"
            >
            </app-chat-card>
          </a>
        }
      }

    </div>

    <app-bottom-nav 
      [activeTab]="activeTab()" 
      (tabSelected)="onTabSelected($event)"
      class="relative z-50">
    </app-bottom-nav>
  </aside>

  <!-- Main Chat Area -->
  <main class="flex-1 flex flex-col min-w-0 bg-slate-900/60 backdrop-blur-xl border border-slate-700/50 rounded-3xl shadow-2xl relative overflow-hidden z-10">
      <router-outlet></router-outlet>
  </main>


  <!-- Right Sidebar (Security Panel) -->
  <aside class="w-72 bg-slate-900/60 backdrop-blur-xl border border-slate-700/50 rounded-3xl shadow-2xl p-5 hidden lg:flex flex-col gap-6 z-20 overflow-hidden">
    
    <h2 class="text-lg font-bold text-white">Security Panel</h2>

    <div>
      <div class="flex justify-between items-center mb-3">
        <h3 class="text-xs font-semibold text-slate-400 uppercase tracking-wider">Active Sessions</h3>
        <span class="material-icons text-slate-500 text-sm cursor-pointer">expand_less</span>
      </div>

      <div class="space-y-3">
        <div class="flex items-center gap-3 bg-slate-800/50 p-2 rounded-lg border border-slate-700">
          <span class="material-icons text-slate-400 text-lg">laptop</span>
          <div class="flex-1 min-w-0">
            <p class="text-xs text-white truncate">MacBook Pro</p>
            <p class="text-[10px] text-slate-500 truncate">192.168.1.10 (US)</p>
          </div>
          <span class="w-2 h-2 rounded-full bg-green-500"></span>
        </div>

        <div class="flex items-center gap-3 bg-slate-800/50 p-2 rounded-lg border border-slate-700">
          <span class="material-icons text-slate-400 text-lg">smartphone</span>
          <div class="flex-1 min-w-0">
            <p class="text-xs text-white truncate">iPhone 13</p>
            <p class="text-[10px] text-slate-500 truncate">10.0.0.5 (UK)</p>
          </div>
          <span class="material-icons text-green-500 text-sm">check_circle</span>
        </div>
        
        <div class="flex items-center gap-3 bg-slate-800/50 p-2 rounded-lg border border-slate-700 opacity-70">
          <span class="material-icons text-slate-400 text-lg">smartphone</span>
          <div class="flex-1 min-w-0">
             <p class="text-xs text-white truncate">iPhone 13</p>
             <p class="text-[10px] text-slate-500">10.0.0.5 (UK)</p>
          </div>
          <span class="material-icons text-green-500 text-sm">check_circle</span>
        </div>
      </div>
    </div>

    <div class="flex-1">
      <div class="flex justify-between items-center mb-3">
        <h3 class="text-xs font-semibold text-slate-400 uppercase tracking-wider">Encrypted Files</h3>
        <span class="material-icons text-slate-500 text-sm cursor-pointer">expand_less</span>
      </div>

      <div class="space-y-2">
        <div class="flex items-center gap-3 p-2 hover:bg-slate-800 rounded transition cursor-pointer group">
          <div class="bg-slate-800 p-2 rounded text-slate-400 group-hover:text-blue-400 transition">
             <span class="material-icons text-lg">lock</span>
          </div>
          <div class="flex-1 overflow-hidden">
            <p class="text-xs text-slate-300 truncate">G4_Report_Encrypted.pdf</p>
            <p class="text-[10px] text-slate-500">2.4 MB</p>
          </div>
        </div>

        <div class="flex items-center gap-3 p-2 hover:bg-slate-800 rounded transition cursor-pointer group">
          <div class="bg-slate-800 p-2 rounded text-slate-400 group-hover:text-blue-400 transition">
             <span class="material-icons text-lg">lock</span>
          </div>
          <div class="flex-1 overflow-hidden">
            <p class="text-xs text-slate-300 truncate">Client_Keys.zip</p>
            <p class="text-[10px] text-slate-500">14 KB</p>
          </div>
        </div>
        
        <button class="w-full mt-4 bg-slate-800 hover:bg-slate-700 border border-slate-600 text-slate-300 text-xs py-2 rounded-lg transition flex items-center justify-center gap-2">
          <span class="material-icons text-sm">cloud_upload</span> Upload New File
        </button>
      </div>
    </div>

  </aside>
</div> 
