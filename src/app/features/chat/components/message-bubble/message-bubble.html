<div class="flex gap-3 max-w-2xl mb-4 animate-fade-in-up" 
     [ngClass]="{'ml-auto justify-end': isMine, 'justify-start': !isMine}">

  @if (!isMine) {
    <div class="flex flex-col justify-end">
        <img [src]="senderAvatar" class="w-8 h-8 rounded-full object-cover ring-2 ring-slate-800" [alt]="senderName">
    </div>
  }

  <div class="flex flex-col space-y-1" [ngClass]="{'items-end': isMine, 'items-start': !isMine}">
    
    @if (!isMine && senderName) {
        <span class="text-[10px] text-slate-500 ml-1">{{ senderName }}</span>
    }

    @if (isCodeBlock) {
        <div class="font-mono text-xs w-full min-w-[280px] sm:min-w-[320px] overflow-hidden rounded-xl border border-slate-700 shadow-lg bg-[#0d1117]">
            <div class="flex items-center gap-1.5 px-3 py-2 border-b border-slate-800 bg-slate-900/50">
                <span class="w-2.5 h-2.5 rounded-full bg-red-500/80"></span>
                <span class="w-2.5 h-2.5 rounded-full bg-yellow-500/80"></span>
                <span class="w-2.5 h-2.5 rounded-full bg-green-500/80"></span>
                <span class="ml-auto text-[10px] text-slate-500">snippet</span>
            </div>
            <div class="p-3 text-slate-300 overflow-x-auto">
                <pre>{{ cleanContent }}</pre>
            </div>
        </div>
    } 
    
    @else {
        <div class="px-4 py-2.5 rounded-2xl text-sm shadow-sm break-words max-w-full"
             [ngClass]="isMine 
                ? 'bg-blue-600 text-white rounded-br-sm shadow-[0_0_15px_rgba(37,99,235,0.3)]' 
                : 'bg-slate-800 text-slate-200 rounded-bl-sm border border-slate-700/50'">
            {{ content }}
        </div>
    }

    <div class="flex items-center gap-1 px-1 opacity-80 select-none">
        <span class="text-[10px] text-slate-500">{{ time | timeAgo }}</span>
        
        @if (isMine) {
            <span class="material-icons text-[14px] transition-colors duration-300" 
                  [ngClass]="isRead ? 'text-blue-400' : 'text-slate-600'">
                done_all
            </span>
        }
    </div>

  </div>

</div>